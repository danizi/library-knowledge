
GradientDrawable 是 Android 中用于创建渐变背景的核心类，支持线性渐变、径向渐变、扫描渐变等多种渐变效果，常用于自定义 View 背景、按钮样式、边框等场景。下面从「核心概念→使用方法→高级技巧」全面解析：
一、核心概念
渐变类型：
LINEAR_GRADIENT（线性渐变）：沿直线方向渐变（默认）；
RADIAL_GRADIENT（径向渐变）：从中心点向外扩散渐变；
SWEEP_GRADIENT（扫描渐变）：从中心点开始，沿顺时针方向扫描渐变。
渐变属性：
colors：渐变颜色数组（至少 2 种颜色）；
orientation（线性渐变）：渐变方向（如 TOP_BOTTOM、LEFT_RIGHT）；
centerX/centerY（径向 / 扫描渐变）：渐变中心点坐标（范围 0~1，相对于 Drawable 宽高）；
radius（径向渐变）：渐变半径（像素值）；
shape：渐变形状（RECTANGLE、OVAL、LINE、RING）；
cornerRadius：圆角半径（仅矩形形状有效）。
二、使用方法
方式 1：XML 定义（推荐，简洁易维护）
在 res/drawable/ 目录下创建 XML 文件（如 gradient_bg.xml）：
xml
<!-- 线性渐变示例：从上到下，蓝到红渐变，圆角矩形 -->
<shape xmlns:android="http://schemas.android.com/apk/res/android"
    android:shape="rectangle"> <!-- 形状：矩形 -->
    <!-- 圆角（可选） -->
    <corners android:radius="12dp" />
    <!-- 线性渐变 -->
    <gradient
        android:type="linear" <!-- 渐变类型：线性 -->
        android:startColor="#2196F3" <!-- 起始颜色：蓝色 -->
        android:endColor="#F44336" <!-- 结束颜色：红色 -->
        android:angle="90" /> <!-- 渐变方向：90度（从上到下），可选值：0/45/90/135/180/225/270/315 -->
    <!-- 边框（可选） -->
    <stroke
        android:width="2dp"
        android:color="#FFC107" />
</shape>
使用方式：在布局中引用该 Drawable：
xml
<Button
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:background="@drawable/gradient_bg"
    android:text="Gradient Button" />
方式 2：代码动态创建（灵活，适合动态变化的场景）
kotlin
// 1. 创建 GradientDrawable 实例
val gradientDrawable = GradientDrawable()

// 2. 设置形状（矩形）
gradientDrawable.shape = GradientDrawable.RECTANGLE

// 3. 设置圆角（可选）
gradientDrawable.cornerRadius = 12f // 单位：dp（需转换为像素，见下方优化）

// 4. 设置渐变类型和颜色
gradientDrawable.gradientType = GradientDrawable.LINEAR_GRADIENT // 线性渐变
gradientDrawable.colors = intArrayOf(Color.BLUE, Color.RED) // 渐变颜色数组
gradientDrawable.orientation = GradientDrawable.Orientation.TOP_BOTTOM // 渐变方向：从上到下

// 5. 设置边框（可选）
gradientDrawable.setStroke(2.dpToPx(this), Color.YELLOW) // 边框宽度（像素）、颜色

// 6. 应用到 View
button.background = gradientDrawable

// 辅助函数：dp 转像素
fun Int.dpToPx(context: Context): Int {
    return TypedValue.applyDimension(
        TypedValue.COMPLEX_UNIT_DIP,
        this.toFloat(),
        context.resources.displayMetrics
    ).toInt()
}
三、高级渐变效果
1. 多色线性渐变
xml
<!-- 三色线性渐变：左到右，蓝→绿→红 -->
<gradient
    android:type="linear"
    android:startColor="#2196F3"
    android:centerColor="#4CAF50" <!-- 中间颜色 -->
    android:endColor="#F44336"
    android:angle="0" /> <!-- 0度：从左到右 -->
2. 径向渐变
xml
<!-- 径向渐变：从中心向外，蓝→红，半径50dp -->
<gradient
    android:type="radial"
    android:startColor="#2196F3"
    android:endColor="#F44336"
    android:centerX="0.5" <!-- 中心点X坐标：50% -->
    android:centerY="0.5" <!-- 中心点Y坐标：50% -->
    android:gradientRadius="50dp" /> <!-- 渐变半径 -->
3. 扫描渐变
xml
<!-- 扫描渐变：从中心点开始，顺时针扫描，红→黄→绿→蓝→红 -->
<gradient
    android:type="sweep"
    android:startColor="#F44336"
    android:centerColor="#FFEB3B"
    android:endColor="#2196F3"
    android:centerX="0.5"
    android:centerY="0.5" />
4. 环形渐变（shape="ring"）
xml
<!-- 环形渐变：蓝→红，内环半径20dp，外环半径50dp -->
<shape xmlns:android="http://schemas.android.com/apk/res/android"
    android:shape="ring"
    android:innerRadius="20dp" <!-- 内环半径 -->
    android:thickness="30dp" <!-- 环厚度（外环半径=内环+厚度） -->
    android:useLevel="false"> <!-- 必须为false，否则环形不显示 -->
    <gradient
        android:type="sweep"
        android:startColor="#2196F3"
        android:endColor="#F44336" />
</shape>
5. 动态渐变（代码实现）
kotlin
// 动态修改渐变颜色
fun updateGradientColors(gradientDrawable: GradientDrawable, colors: IntArray) {
    gradientDrawable.colors = colors
    gradientDrawable.invalidateSelf() // 刷新 Drawable
}

// 示例：点击按钮切换渐变颜色
button.setOnClickListener {
    val newColors = intArrayOf(Color.GREEN, Color.PURPLE)
    updateGradientColors(gradientDrawable, newColors)
}
四、常见问题与解决方案
圆角不生效：
确保 shape 为 RECTANGLE（圆角仅对矩形有效）；
代码中设置圆角时，注意单位转换（dp→像素）。
环形渐变不显示：
必须设置 android:useLevel="false"（XML）或 gradientDrawable.useLevel = false（代码）；
检查 innerRadius 和 thickness 是否合理（外环半径 = 内环 + 厚度）。
渐变方向错误：
线性渐变 angle 仅支持 0/45/90/135/180/225/270/315 度，其他值会被忽略；
代码中使用 Orientation 枚举更直观（如 TOP_BOTTOM、LEFT_RIGHT）。
性能优化：
避免在 onDraw 中频繁创建 GradientDrawable，建议缓存实例；
对于复杂渐变，考虑使用 BitmapShader 或 RenderScript 优化绘制性能。
五、应用场景
按钮背景：渐变按钮，提升视觉效果；
卡片背景：渐变卡片，增强层次感；
进度条：渐变进度条，更直观的进度展示；
自定义 View：如渐变文字、渐变图标等；
启动页 / 引导页：全屏渐变背景，提升品牌感。
